apiVersion: v1
kind: Pod
metadata:
  name: smoke-ok-prod
  namespace: ns-open4goods-prod
  labels: { app: smoke, env: prod }
spec:
  automountServiceAccountToken: false
  securityContext:
    runAsNonRoot: true
    runAsUser: 101
    runAsGroup: 101
    fsGroup: 101
    fsGroupChangePolicy: OnRootMismatch
    seccompProfile: { type: RuntimeDefault }
  containers:
    - name: web
      image: nginxinc/nginx-unprivileged:1.27-alpine
      args: ["sh","-lc","exec nginx -g 'daemon off;'"]
      ports: [{ containerPort: 8080 }]
      securityContext:
        allowPrivilegeEscalation: false
        readOnlyRootFilesystem: true
        capabilities: { drop: ["ALL"] }
        runAsNonRoot: true
      livenessProbe:
        httpGet: { path: "/", port: 8080 }
        initialDelaySeconds: 10
        periodSeconds: 10
      readinessProbe:
        httpGet: { path: "/", port: 8080 }
        initialDelaySeconds: 2
        periodSeconds: 5
      volumeMounts:
        - { name: cache, mountPath: /var/cache/nginx }
        - { name: run,   mountPath: /var/run }
        - { name: log,   mountPath: /var/log/nginx }
  volumes:
    - name: cache
      emptyDir: {}
    - name: run
      emptyDir: {}
    - name: log
      emptyDir: {}
