apiVersion: actions.summerwind.dev/v1alpha1
kind: RunnerDeployment
metadata:
  name: nudger-gitops-recette-runner
  namespace: ns-open4goods-recette
spec:
  replicas: 1
  template:
    spec:
      repository: loicgo29/nudger-gitops
      dockerdWithinRunnerContainer: false
      containers:
        - name: runner
          image: ghcr.io/actions/actions-runner:2.311.0
          envFrom:
            - secretRef:
                name: actions-runner-controller
          env:
            - name: RUNNER_EPHEMERAL
              value: "false"
            - name: RUNNER_WORKDIR
              value: /runner/_work
            - name: DOCKER_ENABLED
              value: "true"
            - name: DOCKERD_IN_RUNNER
              value: "false"
            - name: DOCKER_HOST
              value: unix:///run/docker.sock
          volumeMounts:
            - name: work
              mountPath: /runner/_work
        - name: docker
          image: docker:dind
          securityContext:
            privileged: true
          env:
            - name: DOCKER_GROUP_GID
              value: "1001"
          volumeMounts:
            - name: work
              mountPath: /runner/_work
            - name: var-run
              mountPath: /run
      volumes:
        - name: work
          emptyDir: {}
        - name: var-run
          emptyDir:
            medium: Memory
            sizeLimit: 1Mi
