# ./infra/action-runner-controller/overlays/recette/nudger-gitops-recette-runner.yaml
apiVersion: actions.summerwind.dev/v1alpha1
kind: RunnerDeployment
metadata:
  name: nudger-gitops-recette-runner
  namespace: ns-open4goods-recette
spec:
  replicas: 1
  template:
    spec:
      repository: loicgo29/nudger-gitops
      envFrom:
        - secretRef:
            name: actions-runner-controller
      env:
        - name: RUNNER_EPHEMERAL
          value: "false" # âœ… runner persistant
        - name: DOCKER_ENABLED
          value: "true"
        - name: DOCKERD_IN_RUNNER
          value: "false"
      volumeMounts:
        - name: work
          mountPath: /runner/_work
      containers:
        - name: docker
          image: docker:dind
          securityContext:
            privileged: true
          volumeMounts:
            - name: work
              mountPath: /runner/_work
            - name: runner
              mountPath: /runner
            - name: var-run
              mountPath: /run
      volumes:
        - name: work
          emptyDir: {}
        - name: runner
          emptyDir: {}
        - name: var-run
          emptyDir:
            medium: Memory
            sizeLimit: "1M"
