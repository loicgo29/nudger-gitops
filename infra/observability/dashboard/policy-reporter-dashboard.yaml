apiVersion: v1
kind: ConfigMap
metadata:
  name: dashboard-policy-reporter
  namespace: observability
  labels:
    grafana_dashboard: "1"
data:
  policy-reporter.json: |
    {"__inputs":[{"name":"mydatasource","label":"","description":"","type":"datasource","pluginId":"prometheus","pluginName":"Prometheus"}],"__requires":[{"type":"panel","id":"alertlist","name":"Alert list","version":""},{"type":"grafana","id":"grafana","name":"Grafana","version":"7.5.4"},{"type":"panel","id":"graph","name":"Graph","version":""},{"type":"datasource","id":"prometheus","name":"Prometheus","version":"1.0.0"},{"type":"panel","id":"table","name":"Table","version":""},{"type":"panel","id":"table-old","name":"Table (old)","version":""}],"annotations":{"list":[{"$$hashKey":"object:2875","builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations & Alerts","type":"dashboard"}]},"description":"dashboard id : 14858","editable":false,"gnetId":14858,"graphTooltip":0,"id":null,"iteration":1628648373159,"links":[{"$$hashKey":"object:2300","icon":"bolt","tags":[],"targetBlank":true,"title":"Update","tooltip":"更新当前仪表板","type":"link","url":"https://grafana.com/dashboards/8919"},{"$$hashKey":"object:2301","icon":"question","tags":[],"targetBlank":true,"title":"GitHub","tooltip":"查看更多仪表板","type":"link","url":"https://github.com/starsliao"},{"$$hashKey":"object:2302","asDropdown":true,"icon":"external link","tags":[],"targetBlank":true,"title":"","type":"dashboards"}],"panels":[{"dashboardFilter":"","dashboardTags":[],"datasource":"Prometheus","fieldConfig":{"defaults":{},"overrides":[]},"folderId":null,"gridPos":{"h":9,"w":8,"x":0,"y":0},"id":218,"limit":10,"links":[],"nameFilter":"","onlyAlertsOnDashboard":false,"show":"current","sortOrder":5,"stateFilter":[],"title":"Alerts Status","type":"alertlist"},{"dashboardFilter":"","dashboardTags":[],"datasource":"Prometheus","fieldConfig":{"defaults":{},"overrides":[]},"folderId":null,"gridPos":{"h":9,"w":16,"x":8,"y":0},"id":220,"limit":"10","links":[],"nameFilter":"","onlyAlertsOnDashboard":false,"show":"changes","sortOrder":5,"stateFilter":[],"title":"Alerts Log","type":"alertlist"},{"datasource":"Prometheus","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"custom":{"align":"center","filterable":false},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]}},"overrides":[{"matcher":{"id":"byName","options":"Memory"},"properties":[{"id":"unit","value":"bytes"},{"id":"custom.width","value":70},{"id":"custom.displayMode","value":"color-background"},{"id":"thresholds","value":{"mode":"absolute","steps":[{"color":"green","value":null}]}}]},{"matcher":{"id":"byName","options":"CPU"},"properties":[{"id":"unit","value":"percent"},{"id":"custom.width","value":70},{"id":"decimals","value":2},{"id":"custom.displayMode","value":"color-background"},{"id":"thresholds","value":{"mode":"percentage","steps":[{"color":"green","value":null},{"color":"orange","value":70},{"color":"red","value":80}]}}]},{"matcher":{"id":"byName","options":"Nodes"},"properties":[{"id":"custom.width","value":200},{"id":"custom.align","value":"left"}]},{"matcher":{"id":"byName","options":"Namespace"},"properties":[{"id":"custom.width","value":95}]},{"matcher":{"id":"byName","options":"Pod name"},"properties":[{"id":"custom.width","value":350},{"id":"custom.align","value":null}]},{"matcher":{"id":"byName","options":"Image"},"properties":[{"id":"custom.width","value":600},{"id":"custom.align","value":null}]},{"matcher":{"id":"byName","options":"Status"},"properties":[{"id":"custom.width","value":60},{"id":"custom.align","value":"center"},{"id":"mappings","value":[{"from":"","id":1,"text":"OK","to":"","type":1,"value":"1"},{"from":"","id":2,"text":"Died","to":"","type":1,"value":"0"}]},{"id":"custom.displayMode","value":"color-background"},{"id":"thresholds","value":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":0},{"color":"green","value":1}]}}]},{"matcher":{"id":"byName","options":"Restart"},"properties":[{"id":"custom.width","value":70},{"id":"custom.displayMode","value":"color-background"},{"id":"thresholds","value":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"orange","value":10},{"color":"red","value":100}]}}]},{"matcher":{"id":"byName","options":"Incoming"},"properties":[{"id":"custom.align","value":"center"},{"id":"custom.width","value":80},{"id":"unit","value":"bps"},{"id":"custom.displayMode","value":"color-background"},{"id":"thresholds","value":{"mode":"absolute","steps":[{"color":"green","value":null}]}}]},{"matcher":{"id":"byName","options":"Outgoing"},"properties":[{"id":"custom.width","value":80},{"id":"custom.align","value":"center"},{"id":"unit","value":"bps"},{"id":"custom.displayMode","value":"color-background"},{"id":"thresholds","value":{"mode":"absolute","steps":[{"color":"green","value":null}]}}]},{"matcher":{"id":"byName","options":"Uptime"},"properties":[{"id":"custom.width","value":80},{"id":"unit","value":"s"}]}]},"gridPos":{"h":8,"w":24,"x":0,"y":9},"id":279,"options":{"showHeader":true,"sortBy":[{"desc":true,"displayName":"Restart"}]},"pluginVersion":"7.5.4","targets":[{"exemplar":true,"expr":"container_memory_working_set_bytes{origin_prometheus=~\"$origin_prometheus\",pod=~\"$Pod\",container =~\"$Container\",namespace=~\"$NameSpace\",node=~\"^$Node$\"}","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"memory","refId":"A"},{"exemplar":true,"expr":"(rate (container_cpu_usage_seconds_total{origin_prometheus=~\"$origin_prometheus\",pod=~\"$Pod\",container =~\"$Container\",namespace=~\"$NameSpace\",node=~\"^$Node$\"}[5m]) /8) * 100","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"cpu","refId":"C"},{"exemplar":true,"expr":"kube_pod_container_status_running{pod=~\"$Pod\",container =~\"$Container\",namespace=~\"$NameSpace\"}","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"status","refId":"D"},{"exemplar":true,"expr":"kube_pod_container_status_restarts_total{pod=~\"$Pod\",container =~\"$Container\",namespace=~\"$NameSpace\"}","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"restart","refId":"E"},{"exemplar":true,"expr":"sum (rate (container_network_receive_bytes_total{origin_prometheus=~\"$origin_prometheus\",pod=~\"$Pod\",image!=\"\",name=~\"^k8s_.*\",node=~\"^$Node$\",namespace=~\"$NameSpace\",pod=~\".*$Container.*\"}[2m])) by (pod)*8","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"incoming","refId":"B"},{"exemplar":true,"expr":"sum (rate (container_network_transmit_bytes_total{origin_prometheus=~\"$origin_prometheus\",pod=~\"$Pod\",image!=\"\",name=~\"^k8s_.*\",node=~\"^$Node$\",namespace=~\"$NameSpace\",pod=~\".*$Container.*\"}[2m])) by (pod)*8","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"outgoing","refId":"G"},{"exemplar":true,"expr":"time () - container_start_time_seconds{origin_prometheus=~\"$origin_prometheus\",pod=~\"$Pod\",container =~\"$Container\",namespace=~\"$NameSpace\",node=~\"^$Node$\"}","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"uptime","refId":"H"},{"exemplar":true,"expr":"kube_pod_container_info{pod=~\"$Pod\",container =~\"$Container\",namespace=~\"$NameSpace\"} - 0","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"F"}],"timeFrom":null,"timeShift":null,"title":"Container Resource Overview【Total Pods：$pod_total 】","transformations":[{"id":"seriesToColumns","options":{"byField":"pod"}},{"id":"filterFieldsByName","options":{"include":{"names":["pod","namespace 1","node 1","Value #A","Value #C","Value #D","Value #E","Value #B","Value #G","Value #H","image 4","Value #F"],"pattern":"(node|condition|Value.*)"}}},{"id":"organize","options":{"excludeByName":{"Time 1":true,"Time 10":true,"Time 11":true,"Time 12":true,"Time 13":true,"Time 14":true,"Time 15":true,"Time 16":true,"Time 17":true,"Time 18":true,"Time 19":true,"Time 2":true,"Time 20":true,"Time 3":true,"Time 4":true,"Time 5":true,"Time 6":true,"Time 7":true,"Time 8":true,"Time 9":true,"Value #B":false,"Value #E":false,"Value #F":true,"__name__":true,"app_kubernetes_io_name 1":true,"app_kubernetes_io_name 2":true,"app_kubernetes_io_name 3":true,"app_kubernetes_io_version 1":true,"app_kubernetes_io_version 2":true,"app_kubernetes_io_version 3":true,"condition":false,"instance 1":true,"instance 2":true,"instance 3":true,"job 1":true,"job 2":true,"job 3":true,"k8s_namespace 1":true,"k8s_namespace 2":true,"k8s_namespace 3":true,"k8s_sname 1":true,"k8s_sname 2":true,"k8s_sname 3":true,"origin_prometheus 1":true,"origin_prometheus 2":true,"origin_prometheus 3":true,"pod":false,"status":true},"indexByName":{"Value #A":6,"Value #B":7,"Value #C":5,"Value #D":9,"Value #E":10,"Value #F":11,"Value #G":8,"Value #H":3,"image 4":4,"namespace 1":1,"node 1":0,"pod":2},"renameByName":{"Value":"MemoryUsage","Value #A":"Memory","Value #B":"Incoming","Value #C":"CPU","Value #D":"Status","Value #E":"Restart","Value #F":"","Value #G":"Outgoing","Value #H":"Uptime","Value #I":"CPU使用(核)","Value #J":"内存使用","Value #K":"磁盘使用","Value #L":"磁盘总","Value #M":"内存使用%","Value #N":"内存请求%","Value #O":"内存限制%","Value #P":"CPU使用%","Value #Q":"CPU请求%","Value #R":"CPU限制%","Value #S":"磁盘使用%","Value #T":"Pod上限","condition":"状态","image 3":"Image","image 4":"Image","namespace 1":"Namespace","node":"Node","node 1":"Nodes","pod":"Pod name"}}}],"type":"table"},{"columns":[],"datasource":"Prometheus","description":"","fieldConfig":{"defaults":{},"overrides":[]},"fontSize":"80%","gridPos":{"h":7,"w":12,"x":0,"y":17},"id":205,"pageSize":null,"showHeader":true,"sort":{"col":1,"desc":false},"styles":[{"$$hashKey":"object:1808","alias":"Host","align":"","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":1,"link":false,"linkTooltip":"","linkUrl":"","mappingType":1,"pattern":"nodename","thresholds":[],"type":"string","unit":"bytes"},{"$$hashKey":"object:1809","alias":"Nodes","align":"","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"link":false,"linkTargetBlank":false,"linkTooltip":"浏览主机明细","linkUrl":"d/9CWBz0bik/node-exporter?orgId=1&var-job=${job}&var-hostname=All&var-node=${__cell}&var-device=All&var-origin_prometheus=$origin_prometheus","mappingType":1,"pattern":"instance","thresholds":[],"type":"string","unit":"short"},{"$$hashKey":"object:1810","alias":"Memory","align":"","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"link":false,"mappingType":1,"pattern":"Value #B","thresholds":[],"type":"number","unit":"bytes"},{"$$hashKey":"object:1811","alias":"CPU Cores","align":"center","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":null,"mappingType":1,"pattern":"Value #C","thresholds":[],"type":"number","unit":"short"},{"$$hashKey":"object:1812","alias":"Uptime","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"mappingType":1,"pattern":"Value #D","thresholds":[],"type":"number","unit":"s"},{"$$hashKey":"object:1813","alias":"Disk Usage","align":"center","colorMode":"cell","colors":["rgba(50, 172, 45, 0.97)","rgba(237, 129, 40, 0.89)","rgba(245, 54, 54, 0.9)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"mappingType":1,"pattern":"Value #E","thresholds":["70","85"],"type":"number","unit":"percent"},{"$$hashKey":"object:1814","alias":"CPU Usage","align":"center","colorMode":"cell","colors":["rgba(50, 172, 45, 0.97)","rgba(237, 129, 40, 0.89)","rgba(245, 54, 54, 0.9)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"mappingType":1,"pattern":"Value #F","thresholds":["70","85"],"type":"number","unit":"percent"},{"$$hashKey":"object:1815","alias":"MEM Usage","align":"center","colorMode":"cell","colors":["rgba(50, 172, 45, 0.97)","rgba(237, 129, 40, 0.89)","rgba(245, 54, 54, 0.9)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"mappingType":1,"pattern":"Value #G","thresholds":["70","85"],"type":"number","unit":"percent"},{"$$hashKey":"object:1816","alias":"Disk availa","align":"auto","colorMode":"value","colors":["#F2495C","#FF9830","#73BF69"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"mappingType":1,"pattern":"Value #H","thresholds":["10000000000","20000000000"],"type":"number","unit":"bytes"},{"$$hashKey":"object:1817","alias":"Disk","align":"","colorMode":null,"colors":["rgba(50, 172, 45, 0.97)","rgba(237, 129, 40, 0.89)","rgba(245, 54, 54, 0.9)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"mappingType":1,"pattern":"Value #I","thresholds":[""],"type":"number","unit":"bytes"},{"$$hashKey":"object:1818","alias":"Incoming","align":"center","colorMode":"cell","colors":["rgba(50, 172, 45, 0.97)","rgba(237, 129, 40, 0.89)","rgba(245, 54, 54, 0.9)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"mappingType":1,"pattern":"Value #J","thresholds":["30485760","104857600"],"type":"number","unit":"bps"},{"$$hashKey":"object:1819","alias":"Outgoing","align":"center","colorMode":"cell","colors":["rgba(50, 172, 45, 0.97)","rgba(237, 129, 40, 0.89)","rgba(245, 54, 54, 0.9)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"mappingType":1,"pattern":"Value #K","thresholds":["30485760","104857600"],"type":"number","unit":"bps"},{"$$hashKey":"object:1820","alias":"5 min load","align":"center","colorMode":"value","colors":["#56A64B","rgba(237, 129, 40, 0.89)","rgba(245, 54, 54, 0.9)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"mappingType":1,"pattern":"Value #L","thresholds":["1","5"],"type":"number","unit":"short"},{"$$hashKey":"object:1821","alias":"连接数","align":"auto","colorMode":"cell","colors":["rgba(50, 172, 45, 0.97)","rgba(237, 129, 40, 0.89)","rgba(245, 54, 54, 0.9)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"mappingType":1,"pattern":"Value #M","thresholds":["1000","1500"],"type":"string","unit":"short"},{"$$hashKey":"object:1822","alias":"Ｍemory availa","align":"center","colorMode":"value","colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","#73BF69"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"mappingType":1,"pattern":"Value #N","thresholds":["4000000000","8000000000"],"type":"number","unit":"bytes"},{"$$hashKey":"object:1823","alias":"","align":"right","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"decimals":2,"pattern":"/.*/","thresholds":[],"type":"hidden","unit":"short"}],"targets":[{"exemplar":true,"expr":"node_uname_info{origin_prometheus=~\"$origin_prometheus\",job=~\"$job\"} - 0","format":"table","hide":true,"instant":true,"interval":"","legendFormat":"Host","refId":"A"},{"exemplar":true,"expr":"sum(time() - node_boot_time_seconds{origin_prometheus=~\"$origin_prometheus\",job=~\"$job\"})by(instance)","format":"table","hide":true,"instant":true,"interval":"","legendFormat":"uptime","refId":"D"},{"exemplar":true,"expr":"count(node_cpu_seconds_total{origin_prometheus=~\"$origin_prometheus\",job=~\"$job\",mode='system'}) by (instance)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"CPU core","refId":"C"},{"exemplar":true,"expr":"node_memory_MemTotal_bytes{origin_prometheus=~\"$origin_prometheus\",job=~\"$job\"} - 0","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"Memory","refId":"B"},{"exemplar":true,"expr":"node_memory_MemAvailable_bytes{origin_prometheus=~\"$origin_prometheus\",job=~\"$job\"} - 0","format":"table","hide":true,"instant":true,"interval":"","legendFormat":"","refId":"N"},{"exemplar":true,"expr":"node_filesystem_size_bytes{origin_prometheus=~\"$origin_prometheus\",job=~\"$job\",fstype=~\"ext.*|xfs\",mountpoint !~\".*pod.*\"}-0","format":"table","hide":true,"instant":true,"interval":"","legendFormat":"Disk","refId":"I"},{"exemplar":true,"expr":"node_filesystem_avail_bytes{origin_prometheus=~\"$origin_prometheus\",job=~\"$job\",fstype=~\"ext.*|xfs\",mountpoint !~\".*pod.*\"} - 0","format":"table","hide":true,"instant":true,"interval":"","legendFormat":"disk availability","refId":"H"},{"exemplar":true,"expr":"node_load5{origin_prometheus=~\"$origin_prometheus\",job=~\"$job\"}","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"5 min load","refId":"L"},{"exemplar":true,"expr":"(1 - avg(rate(node_cpu_seconds_total{origin_prometheus=~\"$origin_prometheus\",job=~\"$job\",mode=\"idle\"}[1m])) by (instance)) * 100","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"CPU Usage","refId":"F"},{"exemplar":true,"expr":"(1 - (node_memory_MemAvailable_bytes{origin_prometheus=~\"$origin_prometheus\",job=~\"$job\"} / (node_memory_MemTotal_bytes{origin_prometheus=~\"$origin_prometheus\",job=~\"$job\"})))* 100","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"Memory Usage","refId":"G"},{"exemplar":true,"expr":"max((node_filesystem_size_bytes{origin_prometheus=~\"$origin_prometheus\",job=~\"$job\",fstype=~\"ext.?|xfs\"}-node_filesystem_free_bytes{origin_prometheus=~\"$origin_prometheus\",job=~\"$job\",fstype=~\"ext.?|xfs\"}) *100/(node_filesystem_avail_bytes {origin_prometheus=~\"$origin_prometheus\",job=~\"$job\",fstype=~\"ext.?|xfs\"}+(node_filesystem_size_bytes{origin_prometheus=~\"$origin_prometheus\",job=~\"$job\",fstype=~\"ext.?|xfs\"}-node_filesystem_free_bytes{origin_prometheus=~\"$origin_prometheus\",job=~\"$job\",fstype=~\"ext.?|xfs\"})))by(instance)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"Disk Usage","refId":"E"},{"exemplar":true,"expr":"max(rate(node_network_receive_bytes_total{origin_prometheus=~\"$origin_prometheus\",job=~\"$job\",device=~\"eth0\"}[1m])*8) by (instance)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"Incoming traffic","refId":"J"},{"exemplar":true,"expr":"max(rate(node_network_transmit_bytes_total{origin_prometheus=~\"$origin_prometheus\",job=~\"$job\",device=~\"eth0\"}[1m])*8) by (instance)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"outgoing traffic","refId":"K"},{"expr":"node_netstat_Tcp_CurrEstab{origin_prometheus=~\"$origin_prometheus\",job=~\"$job\"} - 0","format":"table","hide":true,"instant":true,"interval":"","legendFormat":"连接数","refId":"M"}],"timeFrom":null,"timeShift":null,"title":"k8s - Nodes Resource Overview【Total Nodes：$total 】","transform":"table","type":"table-old"},{"alert":{"alertRuleTags":{},"conditions":[{"evaluator":{"params":[100000000],"type":"gt"},"operator":{"type":"and"},"query":{"params":["A","1m","now"]},"reducer":{"params":[],"type":"avg"},"type":"query"},{"evaluator":{"params":[100000000],"type":"gt"},"operator":{"type":"or"},"query":{"params":["B","1m","now"]},"reducer":{"params":[],"type":"avg"},"type":"query"}],"executionErrorState":"alerting","for":"5m","frequency":"1m","handler":1,"name":"[alertname] k8S - Node Total Traffic (Threshold：traffic  > 100 Mbps) alert","noDataState":"no_data","notifications":[{"uid":"x7N0ZFG7k"}]},"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus","description":"","fieldConfig":{"defaults":{},"overrides":[]},"fill":0,"fillGradient":0,"gridPos":{"h":7,"w":12,"x":12,"y":17},"hiddenSeries":false,"id":228,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.5.4","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[{"$$hashKey":"object:10738","alias":"Total_incoming","color":"#E02F44"},{"$$hashKey":"object:10746","alias":"Total_outgoing","color":"#5794F2"}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"exemplar":true,"expr":"sum(max(rate(node_network_receive_bytes_total{device=~\"eth0\"}[1m])*8) by (instance))","format":"time_series","hide":false,"instant":false,"interval":"","legendFormat":"Total_incoming","refId":"A"},{"exemplar":true,"expr":"sum(max(rate(node_network_transmit_bytes_total{device=~\"eth0\"}[1m])*8) by (instance))","hide":false,"interval":"","legendFormat":"Total_outgoing","refId":"B"}],"thresholds":[{"colorMode":"critical","fill":true,"line":true,"op":"gt","value":100000000,"visible":true}],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"k8S - Node Total Traffic (Threshold：traffic  > 100 Mbps)","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:1655","format":"bps","label":null,"logBase":1,"max":null,"min":"0","show":true},{"$$hashKey":"object:1656","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"collapsed":true,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":24},"id":225,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus","decimals":null,"fieldConfig":{"defaults":{},"overrides":[]},"fill":0,"fillGradient":0,"gridPos":{"h":7,"w":12,"x":0,"y":25},"hiddenSeries":false,"id":222,"legend":{"alignAsTable":true,"avg":false,"current":true,"hideEmpty":false,"hideZero":false,"max":true,"min":false,"rightSide":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.5.4","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"exemplar":true,"expr":"kube_statefulset_status_replicas_current{namespace=\"default\"}","hide":false,"interval":"","intervalFactor":1,"legendFormat":"{{statefulset}}","refId":"A"},{"exemplar":true,"expr":"kube_daemonset_status_number_available{namespace=\"default\"}","hide":false,"interval":"","legendFormat":"{{daemonset}}","refId":"B"},{"exemplar":true,"expr":"kube_deployment_status_replicas_available{namespace=\"default\"}","hide":false,"interval":"","legendFormat":"{{deployment}}","refId":"C"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Service Pods available","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:4088","format":"short","label":null,"logBase":1,"max":null,"min":"0","show":true},{"$$hashKey":"object:4089","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus","decimals":null,"fieldConfig":{"defaults":{},"overrides":[]},"fill":0,"fillGradient":0,"gridPos":{"h":7,"w":12,"x":12,"y":25},"hiddenSeries":false,"id":281,"legend":{"alignAsTable":true,"avg":false,"current":true,"hideEmpty":false,"hideZero":false,"max":true,"min":false,"rightSide":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.5.4","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"exemplar":true,"expr":"kube_statefulset_status_replicas_current{namespace=\"istio-system\"}","hide":false,"interval":"","intervalFactor":1,"legendFormat":"{{statefulset}}","refId":"A"},{"exemplar":true,"expr":"kube_daemonset_status_number_available{namespace=\"istio-system\"}","hide":false,"interval":"","legendFormat":"{{daemonset}}","refId":"B"},{"exemplar":true,"expr":"kube_deployment_status_replicas_available{namespace=\"istio-system\"}","hide":false,"interval":"","legendFormat":"{{deployment}}","refId":"C"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Istio Pods available","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:4088","format":"short","label":null,"logBase":1,"max":null,"min":"0","show":true},{"$$hashKey":"object:4089","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus","decimals":null,"fieldConfig":{"defaults":{},"overrides":[]},"fill":0,"fillGradient":0,"gridPos":{"h":7,"w":12,"x":0,"y":32},"hiddenSeries":false,"id":237,"legend":{"alignAsTable":true,"avg":false,"current":true,"hideEmpty":false,"hideZero":false,"max":false,"min":false,"rightSide":true,"show":true,"sort":"current","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.5.4","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"exemplar":true,"expr":"kube_pod_container_status_restarts_total{namespace=\"default\",container!=\"istio-proxy\"}","interval":"","intervalFactor":1,"legendFormat":"{{pod}}：{{container}}","refId":"A"},{"exemplar":true,"expr":"kube_pod_container_status_restarts_total{namespace=\"istio-system\",container!=\"istio-proxy\",container!=\"istio-init-crd-10\",container!=\"istio-init-crd-11\",container!=\"istio-init-crd-14\"}","hide":false,"interval":"","legendFormat":"{{pod}}：{{container}}","refId":"B"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Container Restart","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:4088","format":"short","label":null,"logBase":1,"max":null,"min":"0","show":true},{"$$hashKey":"object:4089","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"alert":{"alertRuleTags":{},"conditions":[{"evaluator":{"params":[1],"type":"lt"},"operator":{"type":"and"},"query":{"params":["A","1m","now"]},"reducer":{"params":[],"type":"last"},"type":"query"},{"evaluator":{"params":[1],"type":"lt"},"operator":{"type":"or"},"query":{"params":["B","1m","now"]},"reducer":{"params":[],"type":"last"},"type":"query"}],"executionErrorState":"alerting","for":"5m","frequency":"1m","handler":1,"message":"current : 1 (Running)\ncurrent : 0 (Died)","name":"[alertname] Container Status of running (Threshold：current  < 1) alert","noDataState":"no_data","notifications":[{"uid":"x7N0ZFG7k"}]},"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus","description":"current : 1 (Running)\ncurrent : 0 (Died)","fieldConfig":{"defaults":{},"overrides":[]},"fill":0,"fillGradient":0,"gridPos":{"h":7,"w":12,"x":12,"y":32},"hiddenSeries":false,"id":280,"legend":{"alignAsTable":true,"avg":false,"current":true,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.5.4","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"exemplar":true,"expr":"kube_pod_container_status_running{namespace=\"default\",container!=\"istio-proxy\"}","hide":false,"interval":"","intervalFactor":1,"legendFormat":"{{pod}}：{{container}}","refId":"A"},{"exemplar":true,"expr":"kube_pod_container_status_running{namespace=\"istio-system\",container!=\"istio-proxy\",container!=\"istio-init-crd-10\",container!=\"istio-init-crd-11\",container!=\"istio-init-crd-14\"}","hide":false,"interval":"","legendFormat":"{{pod}}：{{container}}","refId":"B"}],"thresholds":[{"colorMode":"critical","fill":true,"line":true,"op":"lt","value":1,"visible":true}],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Container Status of running (Threshold：current  < 1)","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"transformations":[],"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:8986","format":"short","label":null,"logBase":1,"max":null,"min":"0","show":true},{"$$hashKey":"object:8987","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus","decimals":2,"fieldConfig":{"defaults":{},"overrides":[]},"fill":0,"fillGradient":0,"gridPos":{"h":9,"w":12,"x":0,"y":39},"hiddenSeries":false,"id":283,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":false,"rightSide":false,"show":true,"sideWidth":null,"sort":"current","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.5.4","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"exemplar":true,"expr":"(rate (container_cpu_usage_seconds_total{origin_prometheus=~\"$origin_prometheus\",pod=~\"$Pod\",container =~\"$Container\",namespace=~\"$NameSpace\",node=~\"^$Node$\"}[5m]) /8) * 100","interval":"","legendFormat":"{{node}} : {{pod}}：{{container}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Container CPU Usage","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:221","decimals":2,"format":"percent","label":null,"logBase":1,"max":null,"min":"0","show":true},{"$$hashKey":"object:222","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus","decimals":2,"fieldConfig":{"defaults":{},"overrides":[]},"fill":0,"fillGradient":0,"gridPos":{"h":9,"w":12,"x":12,"y":39},"hiddenSeries":false,"id":285,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":false,"rightSide":false,"show":true,"sideWidth":null,"sort":"current","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.5.4","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"exemplar":true,"expr":"container_memory_working_set_bytes{origin_prometheus=~\"$origin_prometheus\",pod=~\"$Pod\",container =~\"$Container\",namespace=~\"$NameSpace\",node=~\"^$Node$\"}","interval":"","legendFormat":"{{node}} : {{pod}}：{{container}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Container Memory Usage","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:221","decimals":null,"format":"bytes","label":null,"logBase":1,"max":null,"min":"0","show":true},{"$$hashKey":"object:222","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{"流入:wholion-lbs":"purple","流出:wholion-lbs":"green"},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus","decimals":2,"editable":true,"error":false,"fieldConfig":{"defaults":{"links":[]},"overrides":[]},"fill":0,"fillGradient":0,"grid":{},"gridPos":{"h":10,"w":12,"x":0,"y":48},"hiddenSeries":false,"id":276,"isNew":true,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":false,"rightSide":false,"show":true,"sideWidth":null,"sort":"current","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.5.4","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"exemplar":true,"expr":"sum (sum (rate (container_network_receive_bytes_total{origin_prometheus=~\"$origin_prometheus\",pod=~\"$Pod\",image!=\"\",name=~\"^k8s_.*\",node=~\"^$Node$\",namespace=~\"$NameSpace\",pod=~\".*$Container.*\"}[1m])) by (pod)* on(pod)  group_right kube_pod_container_info) by(container)*8","hide":false,"interval":"","intervalFactor":1,"legendFormat":"Incoming : {{ container }}","metric":"network","refId":"A","step":10},{"exemplar":true,"expr":"sum (rate (container_network_receive_bytes_total{origin_prometheus=~\"$origin_prometheus\",pod=~\"$Pod\",image!=\"\",name=~\"^k8s_.*\",node=~\"^$Node$\",namespace=~\"$NameSpace\",pod=~\".*$Container.*\"}[1m])) by (pod)","hide":true,"interval":"","intervalFactor":1,"legendFormat":"-> {{ pod }}","metric":"network","refId":"C","step":10}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Container Incoming traffic (total)","tooltip":{"msResolution":false,"shared":true,"sort":2,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:8106","format":"bps","label":null,"logBase":1,"max":null,"min":null,"show":true},{"$$hashKey":"object:8107","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{"流入:wholion-lbs":"purple","流出:wholion-lbs":"green"},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus","decimals":2,"editable":true,"error":false,"fieldConfig":{"defaults":{"links":[]},"overrides":[]},"fill":0,"fillGradient":0,"grid":{},"gridPos":{"h":10,"w":12,"x":12,"y":48},"hiddenSeries":false,"id":277,"isNew":true,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":false,"rightSide":false,"show":true,"sideWidth":null,"sort":"current","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.5.4","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"exemplar":true,"expr":"sum (sum (rate (container_network_transmit_bytes_total{origin_prometheus=~\"$origin_prometheus\",pod=~\"$Pod\",image!=\"\",name=~\"^k8s_.*\",node=~\"^$Node$\",namespace=~\"$NameSpace\",pod=~\".*$Container.*\"}[2m])) by (pod)* on(pod)  group_right kube_pod_container_info) by(container) *8","interval":"","intervalFactor":1,"legendFormat":"Outgoing : {{ container }}","metric":"network","refId":"B","step":10},{"expr":"- sum (rate (container_network_transmit_bytes_total{origin_prometheus=~\"$origin_prometheus\",pod=~\"$Pod\",image!=\"\",name=~\"^k8s_.*\",node=~\"^$Node$\",namespace=~\"$NameSpace\",pod=~\".*$Container.*\"}[2m])) by (pod)","hide":true,"interval":"","intervalFactor":1,"legendFormat":"<- {{ pod }}","metric":"network","refId":"D","step":10}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Container Outgoing traffic  (total)","tooltip":{"msResolution":false,"shared":true,"sort":2,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:8106","format":"bps","label":null,"logBase":1,"max":null,"min":null,"show":true},{"$$hashKey":"object:8107","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}],"yaxis":{"align":false,"alignLevel":null}}],"title":"Pods Status Monitoring","type":"row"},{"collapsed":true,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":25},"id":204,"panels":[{"alert":{"alertRuleTags":{},"conditions":[{"evaluator":{"params":[3],"type":"lt"},"operator":{"type":"and"},"query":{"params":["C","1m","now"]},"reducer":{"params":[],"type":"last"},"type":"query"},{"evaluator":{"params":[0],"type":"gt"},"operator":{"type":"or"},"query":{"params":["A","1m","now"]},"reducer":{"params":[],"type":"last"},"type":"query"}],"executionErrorState":"alerting","for":"5m","frequency":"1m","handler":1,"name":"[alertname] K8S  - Nodes Status (Threshold：Number of node  < 3) alert","noDataState":"no_data","notifications":[]},"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus","description":"","fieldConfig":{"defaults":{},"overrides":[]},"fill":0,"fillGradient":0,"gridPos":{"h":7,"w":12,"x":0,"y":26},"hiddenSeries":false,"id":255,"legend":{"alignAsTable":true,"avg":false,"current":true,"max":true,"min":false,"rightSide":true,"show":true,"sort":"current","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.5.4","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[{"$$hashKey":"object:8108","alias":"Nodes Unavailable","color":"#F2495C"}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"exemplar":true,"expr":"sum(kube_node_info)","format":"time_series","hide":false,"instant":false,"interval":"","intervalFactor":1,"legendFormat":"Nodes available","refId":"C"},{"exemplar":true,"expr":"sum(kube_node_spec_unschedulable)","hide":false,"interval":"","legendFormat":"Nodes Unavailable","refId":"A"}],"thresholds":[{"colorMode":"critical","fill":true,"line":true,"op":"lt","value":3,"visible":true}],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"K8S  - Nodes Status (Threshold：Number of node  < 3)","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:1655","format":"short","label":null,"logBase":1,"max":null,"min":"0","show":true},{"$$hashKey":"object:1656","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"alert":{"alertRuleTags":{},"conditions":[{"evaluator":{"params":[80],"type":"gt"},"operator":{"type":"and"},"query":{"params":["C","1m","now"]},"reducer":{"params":[],"type":"avg"},"type":"query"}],"executionErrorState":"alerting","for":"5m","frequency":"1m","handler":1,"name":"[alertname] K8S - Nodes CPU Usage (Threshold：Usage  > 80%) alert","noDataState":"no_data","notifications":[]},"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus","description":"","fieldConfig":{"defaults":{},"overrides":[]},"fill":0,"fillGradient":0,"gridPos":{"h":7,"w":12,"x":12,"y":26},"hiddenSeries":false,"id":254,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":false,"rightSide":true,"show":true,"sort":"current","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.5.4","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"exemplar":true,"expr":"(1 - avg(rate(node_cpu_seconds_total{mode=\"idle\"}[1m])) by (instance)) * 100","format":"time_series","hide":false,"instant":false,"interval":"","intervalFactor":1,"legendFormat":"{{instance}}","refId":"C"}],"thresholds":[{"colorMode":"critical","fill":true,"line":true,"op":"gt","value":80,"visible":true}],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"K8S - Nodes CPU Usage (Threshold：Usage  > 80%)","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:1655","format":"percent","label":null,"logBase":1,"max":null,"min":"0","show":true},{"$$hashKey":"object:1656","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"alert":{"alertRuleTags":{},"conditions":[{"evaluator":{"params":[80],"type":"gt"},"operator":{"type":"and"},"query":{"params":["A","1m","now"]},"reducer":{"params":[],"type":"avg"},"type":"query"}],"executionErrorState":"alerting","for":"5m","frequency":"1m","handler":1,"name":"[alertname] K8S - Nodes Disk Usage (Threshold：Usage  > 80%) alert","noDataState":"no_data","notifications":[]},"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus","description":"","fieldConfig":{"defaults":{},"overrides":[]},"fill":0,"fillGradient":0,"gridPos":{"h":7,"w":12,"x":0,"y":33},"hiddenSeries":false,"id":202,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":false,"rightSide":true,"show":true,"sort":"current","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.5.4","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"exemplar":true,"expr":"(node_filesystem_size_bytes{fstype=~\"ext.*|xfs\",mountpoint !~\".*pod.*\"}-node_filesystem_free_bytes{fstype=~\"ext.*|xfs\",mountpoint !~\".*pod.*\"}) *100/(node_filesystem_avail_bytes {fstype=~\"ext.*|xfs\",mountpoint !~\".*pod.*\"}+(node_filesystem_size_bytes{fstype=~\"ext.*|xfs\",mountpoint !~\".*pod.*\"}-node_filesystem_free_bytes{fstype=~\"ext.*|xfs\",mountpoint !~\".*pod.*\"}))","format":"time_series","hide":false,"interval":"","legendFormat":"{{instance}}","refId":"A"}],"thresholds":[{"colorMode":"critical","fill":true,"line":true,"op":"gt","value":80,"visible":true}],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"K8S - Nodes Disk Usage (Threshold：Usage  > 80%)","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:1655","format":"percent","label":null,"logBase":1,"max":null,"min":"0","show":true},{"$$hashKey":"object:1656","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"alert":{"alertRuleTags":{},"conditions":[{"evaluator":{"params":[80],"type":"gt"},"operator":{"type":"and"},"query":{"params":["C","1m","now"]},"reducer":{"params":[],"type":"avg"},"type":"query"}],"executionErrorState":"alerting","for":"5m","frequency":"1m","handler":1,"name":"[alertname] K8S - Nodes Memory Usage (Threshold：Usage  > 80%) alert","noDataState":"no_data","notifications":[]},"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus","description":"","fieldConfig":{"defaults":{},"overrides":[]},"fill":0,"fillGradient":0,"gridPos":{"h":7,"w":12,"x":12,"y":33},"hiddenSeries":false,"id":200,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":false,"rightSide":true,"show":true,"sort":"current","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.5.4","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"exemplar":true,"expr":"(1 - (node_memory_MemAvailable_bytes / (node_memory_MemTotal_bytes)))* 100","format":"time_series","hide":false,"instant":false,"interval":"","intervalFactor":1,"legendFormat":"{{instance}}","refId":"C"}],"thresholds":[{"colorMode":"critical","fill":true,"line":true,"op":"gt","value":80,"visible":true}],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"K8S - Nodes Memory Usage (Threshold：Usage  > 80%)","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:1655","format":"percent","label":null,"logBase":1,"max":null,"min":"0","show":true},{"$$hashKey":"object:1656","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"alert":{"alertRuleTags":{},"conditions":[{"evaluator":{"params":[15000000],"type":"gt"},"operator":{"type":"and"},"query":{"params":["A","1m","now"]},"reducer":{"params":[],"type":"avg"},"type":"query"}],"executionErrorState":"alerting","for":"5m","frequency":"1m","handler":1,"name":"[alertname] k8S - Nodes Incoming traffic (Threshold：traffic  > 15 Mbps) alert","noDataState":"no_data","notifications":[]},"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus","description":"","fieldConfig":{"defaults":{},"overrides":[]},"fill":0,"fillGradient":0,"gridPos":{"h":9,"w":12,"x":0,"y":40},"hiddenSeries":false,"id":206,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":false,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.5.4","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"exemplar":true,"expr":"max(rate(node_network_receive_bytes_total{device=~\"eth0\"}[1m])*8) by (instance)","format":"time_series","hide":false,"interval":"","legendFormat":"Incoming : {{instance}}","refId":"A"}],"thresholds":[{"colorMode":"critical","fill":true,"line":true,"op":"gt","value":15000000,"visible":true}],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"k8S - Nodes Incoming traffic (Threshold：traffic  > 15 Mbps)","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:1655","format":"bps","label":null,"logBase":1,"max":null,"min":"0","show":true},{"$$hashKey":"object:1656","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"alert":{"alertRuleTags":{},"conditions":[{"evaluator":{"params":[15000000],"type":"gt"},"operator":{"type":"and"},"query":{"params":["A","1m","now"]},"reducer":{"params":[],"type":"avg"},"type":"query"}],"executionErrorState":"alerting","for":"5m","frequency":"1m","handler":1,"name":"[alertname] k8S - Nodes Outgoing traffic (Threshold：traffic  > 15 Mbps) alert","noDataState":"no_data","notifications":[]},"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus","description":"","fieldConfig":{"defaults":{},"overrides":[]},"fill":0,"fillGradient":0,"gridPos":{"h":9,"w":12,"x":12,"y":40},"hiddenSeries":false,"id":227,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":false,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.5.4","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"exemplar":true,"expr":"max(rate(node_network_transmit_bytes_total{device=~\"eth0\"}[1m])*8) by (instance)","format":"time_series","hide":false,"interval":"","legendFormat":"Outgoing : {{instance}}","refId":"A"}],"thresholds":[{"colorMode":"critical","fill":true,"line":true,"op":"gt","value":15000000,"visible":true}],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"k8S - Nodes Outgoing traffic (Threshold：traffic  > 15 Mbps)","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:1655","format":"bps","label":null,"logBase":1,"max":null,"min":"0","show":true},{"$$hashKey":"object:1656","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}}],"title":"K8S Nodes Resource Monitoring","type":"row"}],"refresh":"1m","schemaVersion":27,"style":"dark","tags":[],"templating":{"list":[{"allFormat":"glob","allValue":null,"current":{},"datasource":"Prometheus","definition":"label_values(kube_node_info{origin_prometheus=~\"$origin_prometheus\"},node)","description":null,"error":null,"hide":2,"includeAll":true,"label":"Node","multi":false,"multiFormat":"regex values","name":"Node","options":[],"query":{"query":"label_values(kube_node_info{origin_prometheus=~\"$origin_prometheus\"},node)","refId":"StandardVariableQuery"},"refresh":1,"regex":"","skipUrlSync":false,"sort":5,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":"","current":{},"datasource":"Prometheus","definition":"label_values(origin_prometheus)","description":null,"error":null,"hide":2,"includeAll":false,"label":"DataSource","multi":false,"name":"origin_prometheus","options":[],"query":{"query":"label_values(origin_prometheus)","refId":"origin_prometheus-Variable-Query"},"refresh":1,"regex":"","skipUrlSync":false,"sort":5,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{},"datasource":"Prometheus","definition":"label_values(node_uname_info{origin_prometheus=~\"$origin_prometheus\"}, job)","description":null,"error":null,"hide":2,"includeAll":false,"label":"JOB","multi":false,"name":"job","options":[],"query":{"query":"label_values(node_uname_info{origin_prometheus=~\"$origin_prometheus\"}, job)","refId":"job-Variable-Query"},"refresh":1,"regex":"","skipUrlSync":false,"sort":5,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{},"datasource":"Prometheus","definition":"query_result(count(node_uname_info{origin_prometheus=~\"$origin_prometheus\",job=~\"$job\"}))","description":null,"error":null,"hide":2,"includeAll":false,"label":"主机数","multi":false,"name":"total","options":[],"query":{"query":"query_result(count(node_uname_info{origin_prometheus=~\"$origin_prometheus\",job=~\"$job\"}))","refId":"StandardVariableQuery"},"refresh":1,"regex":"/{} (.*) .*/","skipUrlSync":false,"sort":0,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{},"datasource":"Prometheus","definition":"label_values(kube_namespace_labels{origin_prometheus=~\"$origin_prometheus\"},namespace)","description":null,"error":null,"hide":0,"includeAll":true,"label":"NameSpace","multi":false,"name":"NameSpace","options":[],"query":{"query":"label_values(kube_namespace_labels{origin_prometheus=~\"$origin_prometheus\"},namespace)","refId":"StandardVariableQuery"},"refresh":1,"regex":"","skipUrlSync":false,"sort":5,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{},"datasource":"Prometheus","definition":"label_values(kube_pod_container_info{origin_prometheus=~\"$origin_prometheus\",namespace=~\"$NameSpace\"},container)","description":null,"error":null,"hide":0,"includeAll":true,"label":"Container","multi":false,"name":"Container","options":[],"query":{"query":"label_values(kube_pod_container_info{origin_prometheus=~\"$origin_prometheus\",namespace=~\"$NameSpace\"},container)","refId":"StandardVariableQuery"},"refresh":1,"regex":"/[^istio\\-proxy]/","skipUrlSync":false,"sort":5,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{},"datasource":"Prometheus","definition":"label_values(kube_pod_container_info{origin_prometheus=~\"$origin_prometheus\",namespace=~\"$NameSpace\",container=~\"$Container\"},pod)","description":null,"error":null,"hide":0,"includeAll":true,"label":"Pod","multi":false,"name":"Pod","options":[],"query":{"query":"label_values(kube_pod_container_info{origin_prometheus=~\"$origin_prometheus\",namespace=~\"$NameSpace\",container=~\"$Container\"},pod)","refId":"StandardVariableQuery"},"refresh":1,"regex":"","skipUrlSync":false,"sort":5,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{},"datasource":"Prometheus","definition":"query_result(count(kube_pod_container_info{origin_prometheus=~\"$origin_prometheus\",pod=~\"$Pod\",container =~\"$Container\",namespace=~\"$NameSpace\"}))","description":null,"error":null,"hide":2,"includeAll":false,"label":"pod數量","multi":false,"name":"pod_total","options":[],"query":{"query":"query_result(count(kube_pod_container_info{origin_prometheus=~\"$origin_prometheus\",pod=~\"$Pod\",container =~\"$Container\",namespace=~\"$NameSpace\"}))","refId":"StandardVariableQuery"},"refresh":1,"regex":"/{} (.*) .*/","skipUrlSync":false,"sort":0,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{},"datasource":"Prometheus","definition":"query_result(sum(rabbitmq_identity_info{namespace=\"default\"}))","description":null,"error":null,"hide":2,"includeAll":false,"label":"rabbitmq數量","multi":false,"name":"mq_total","options":[],"query":{"query":"query_result(sum(rabbitmq_identity_info{namespace=\"default\"}))","refId":"StandardVariableQuery"},"refresh":1,"regex":"/{} (.*) .*/","skipUrlSync":false,"sort":0,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false}]},"time":{"from":"now-15m","to":"now"},"timepicker":{"hidden":false,"now":true,"refresh_intervals":["15s","30s","1m","5m","15m","30m"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"browser","title":"k8s-alert","uid":"ZKpFPuZ27","version":137}
