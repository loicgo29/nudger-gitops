apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: loki
  namespace: logging
spec:
  interval: 10m
  chart:
    spec:
      sourceRef: { kind: HelmRepository, name: grafana, namespace: flux-system }
      chart: loki-stack              # ðŸ‘ˆ tu utilises bien loki-stack
      version: "2.10.2"              # ðŸ‘ˆ corrige la version du CHART (pas de lâ€™image)
  values:
    grafana:
      enabled: false                 # ðŸ‘ˆ laisse Ã  false (tu as Grafana Ã  part)
    promtail:
      enabled: false
    loki:
      enabled: true
      podSecurityPolicy:
        enabled: false
      auth_enabled: false
      image:
        repository: grafana/loki
        tag: "2.9.3"
      persistence:
        enabled: true
        size: 10Gi
        storageClassName: longhorn
      resources:
        requests:
          cpu: 100m
          memory: 200Mi
        limits:
          memory: 600Mi
      config:
        limits_config:
          ingestion_rate_mb: 8
          ingestion_burst_size_mb: 16
          reject_old_samples: true
          reject_old_samples_max_age: 24h
          max_streams_per_user: 10000
          max_global_streams_per_user: 20000
        chunk_store_config:
          max_look_back_period: 24h
        table_manager:
          retention_deletes_enabled: true
          retention_period: 48h
