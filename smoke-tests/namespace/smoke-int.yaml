# smoke-int-ok.yaml
apiVersion: v1
kind: Pod
metadata:
  name: smoke-ok-int
  namespace: open4goods-integration
  labels:
    app: smoke
    env: integration
spec:
  automountServiceAccountToken: false
  securityContext:
    runAsNonRoot: true
    runAsUser: 101
    runAsGroup: 101
    fsGroup: 101
    seccompProfile: { type: RuntimeDefault }
  containers:
    - name: web
      image: nginxinc/nginx-unprivileged:1.27-alpine
      ports: [{ containerPort: 8080 }]
      args: ["sh","-lc","exec nginx -g 'daemon off;'"]
      securityContext:
        allowPrivilegeEscalation: false
        readOnlyRootFilesystem: true
        capabilities: { drop: ["ALL"] }
        runAsNonRoot: true
      volumeMounts:
        - { name: cache, mountPath: /var/cache/nginx }
        - { name: run,   mountPath: /var/run }
        - { name: log,   mountPath: /var/log/nginx }
      readinessProbe:
        httpGet: { path: "/", port: 8080 }
        initialDelaySeconds: 2
        periodSeconds: 5
      livenessProbe:
        httpGet: { path: "/", port: 8080 }
        initialDelaySeconds: 10
        periodSeconds: 10
  volumes:
    - name: cache
      emptyDir: {}
    - name: run
      emptyDir: {}
    - name: log
      emptyDir: {}
