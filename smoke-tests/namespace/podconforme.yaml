apiVersion: v1
kind: Pod
metadata:
  name: smoke-ok-prod
  namespace: ns-open4goods-prod
  labels:
    app: smoke
    env: prod
spec:
  automountServiceAccountToken: false
  securityContext:
    runAsNonRoot: true
    runAsUser: 101
    runAsGroup: 101
    fsGroup: 101
    seccompProfile: { type: RuntimeDefault }

  volumes:
    - name: cache
      emptyDir: {}
    - name: run
      emptyDir: {}
    - name: log
      emptyDir: {}
    - name: tmp
      emptyDir: {}

  containers:
    - name: web
      image: nginxinc/nginx-unprivileged:1.27-alpine
      ports: [{ containerPort: 8080 }]
      args: ["sh","-lc","exec nginx -g 'daemon off;'"]
      securityContext:
        allowPrivilegeEscalation: false
        readOnlyRootFilesystem: true
        capabilities: { drop: ["ALL"] }
        runAsNonRoot: true
      volumeMounts:
        - { name: cache, mountPath: /var/cache/nginx }
        - { name: run,   mountPath: /var/run }
        - { name: log,   mountPath: /var/log/nginx }
        - { name: tmp,   mountPath: /tmp }
