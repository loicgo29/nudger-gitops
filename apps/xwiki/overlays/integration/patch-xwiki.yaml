apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: xwiki
spec:
  timeout: 30m
  dependsOn:
    - name: mysql-xwiki
      namespace: ns-open4goods-integration
  values:
    externalDB:
      host: mysql-xwiki.ns-open4goods-integration.svc.cluster.local
      user: xwiki
      database: xwiki
      password: xwikiPass123
    ingress:
      enabled: true
      ingressClassName: nginx
      hosts:
        - host: xwiki.integration.nudger.logo-solutions.fr
          paths:
            - path: /
              pathType: Prefix
      tls: [] 
    # probes adapt√©es
    livenessProbe:
      httpGet:
        path: /rest
        port: 8080
      initialDelaySeconds: 120
      periodSeconds: 20
      failureThreshold: 10
    readinessProbe:
      httpGet:
        path: /rest/wikis/xwiki/spaces
        port: 8080
      initialDelaySeconds: 180
      periodSeconds: 20
      failureThreshold: 15
